{% extends "hotel/hotelbase.html" %}
{% load static %}


{% block body %}

<style>
    /* Button Styles */
    .button {
      display: inline-block;
      padding-left: 3px;
      /* padding: :left:3px; */
      background-color: #4CAF50;
      color: white;
      text-align: center;
      text-decoration: none;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      height: 40px;
    }
    
    /* Button Hover Effect */
    .button:hover {
      background-color: #45a049;
    }
    
    /* Button Focus Effect */
    .button:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.2);
    }
    
    /* Button Disabled State */
    .button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    
    /* Button Disabled Hover Effect */
    .button:disabled:hover {
      background-color: #cccccc;
    }
    </style>

<!-- checkout-detsils --> 
<section class="checkout-page xl:py-[100px] py-[70px] selection-list">
    <div class="flex flex-wrap justify-between items-center mx-auto 2xl:max-w-[1320px] xl:max-w-[1140px] lg:max-w-[960px] md:max-w-[720px] sm:max-w-[540px]">
    
        <div class="flex flex-wrap w-full mb-[-24px]">
            <div class="lg:w-8/12 w-full px-[12px] mb-[24px] check-dash" data-aos="fade-up" data-aos-duration="2000">
                
                <div class="lh-checkout">
                    <div class="lh-checkout-content">
                        <div class="lh-checkout-inner mb-[-24px]">
                            <div class="lh-checkout-wrap p-[24px] border-[1px] border-solid border-[#e3e1e1] bg-[#fff] rounded-[15px] mb-[24px]">
                                <div class="lh-checkout-block lh-check-new mb-[24px]">
                                    <h3 class="text-[20px] font-semibold font-Montserrat border-b tracking-normal mb-[25px] relative block text-[#333] leading-[1]">Selected Rooms</h3>
                                    <div class="lh-check-block-content ">
                                        {% for r in booking.room.all %}
                                        <div class="block pb-6 mb-6 -mx-4 border-b border-gray-300 dark:border-gray-700 md:flex">
                                            
                                            <div class="w-full px-4 md:2/3">
                                                <div class="flex justify-between">
                                                    <div>
                                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]"> Room: {{r.room_type.type}}</p>
                                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]"> {{r.room_type.number_of_beds}} Bed(s)</p>
                                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]"> Room Number: {{r.room_number}} </p>
                                                        
                                                    </div>
                                                    <div>
                                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">Kshs.{{r.room_type.price}}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div> 
                                        {% empty %}
                                        <div class="block pb-6 mb-6 -mx-4 border-b border-gray-300 dark:border-gray-700 md:flex">
                                            
                                            <div class="w-full px-4 md:2/3">
                                                <div class="flex justify-between">
                                                    <div>
                                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]"> No rooms selected yet.</p>
                                                        
                                                    </div>
                                                    
                                                </div>
                                            </div>
                                        </div> 
                                        {% endfor %}
                                    </div>
                                </div>
                                
                            </div>
                            <div class="lh-checkout-wrap p-[24px] border-[1px] border-solid border-[#e3e1e1] bg-[#fff] rounded-[15px] mb-[24px]">
                                <div class="lh-checkout-block lh-check-bill">
                                    <h3 class="text-[20px] font-semibold font-Montserrat tracking-normal mb-[25px] relative block text-[#333] leading-[1]">Billing Details</h3>
                                    <div class="lh-bl-block-content">
                                        <div class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">Checkout Options</div>
                                        
                                        <div class="lh-check-bill-form">
                                            <form action="#" method="post" class="flex flex-row flex-wrap mx-[-15px] mb-[-15px]">
                                                {% csrf_token %}
                                                <span class="lh-bill-wrap sm:w-[100%] w-full px-[15px] mb-[15px]">
                                                    <label class="mb-[7px] text-[#333] text-[15px] font-medium tracking-normal leading-[1]">Name</label>
                                                    <input type="text" name="name" value="{{booking.fullname}}" class="bg-transparent px-[15px] w-full h-[50px] rounded-[15px] outline-0 border border-solid border-[#e3e1e1] text-[14px] text-[#333]" readonly style="background-color: rgb(123, 127, 129);">
                                                </span>
                                                
                                                <span class="lh-bill-wrap sm:w-[50%] w-full px-[15px] mb-[15px]">
                                                    <label class="mb-[7px] text-[#333] text-[15px] font-medium tracking-normal leading-[1]">Email</label>
                                                    <input type="email" name="email"value="{{booking.email}}" class="bg-transparent px-[15px] w-full h-[50px] rounded-[15px] outline-0 border border-solid border-[#e3e1e1] text-[14px] text-[#333]" readonly style="background-color: rgb(123, 127, 129);">
                                                </span>
                                                <span class="lh-bill-wrap sm:w-[50%] w-full px-[15px] mb-[15px]">
                                                    <label class="mb-[7px] text-[#333] text-[15px] font-medium tracking-normal leading-[1]">Phone Number</label>
                                                    <input type="text" name="phone" value="{{booking.phone}}"class="bg-transparent px-[15px] w-full h-[50px] rounded-[15px] outline-0 border border-solid border-[#e3e1e1] text-[14px] text-[#333]" readonly style="background-color: rgb(123, 127, 129);">
                                                </span> 
                                                <!-- <div class="mt-[24px] d-flex"></div>                                              
                                                <div class="mt-[24px] d-flex"><button type="submit" class="duration-[0.3s] ease-in-out border-[1px] border-solid border-[#ed5b31] px-[15px] py-[5px] leading-[28px] bg-[#ed5b31] text-[#fff] relative z-[2] text-[15px] font-medium tracking-[1px] rounded-[10px] hover:bg-inherit hover:text-[#ed5b31]">Continue to checkout</button></div>                                              
                                                 -->
                                            </form>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>  
            </div>
            <div class="lg:w-4/12 w-full px-[12px] mb-[24px]" data-aos="fade-up" data-aos-duration="3000">
                <div class="lh-side-room bg-[#f7f5f1] rounded-[15px] sticky top-[80px]">
                    <div class="relative w-full p-1">
                        <img src="{{booking.hotel.image.url}}" />
                        <div class="absolute bottom-0 left-0 right-0 px-4 py-2 bg-gray-800 opacity-70">
                            <h3 class="text-xl text-white font-bold">
                                {{booking.hotel.name}}</h3>
                            <p class="mt-2 text-sm text-gray-300">{{ booking.hotel.mobile }}</p>
                            <p class="mt-2 text-sm text-gray-300">{{ booking.hotel.address }}</p>
                        </div>
                    </div>
                    <h4 class="lh-room-inner-heading p-[20px] text-[18px] text-[#000] font-bold border-b border-solid border-[#e3e1e1]">
                        Booking Summary</h4>
                    <div class="lh-side-reservation pt-0 pr-[24px] pl-[24px] pb-[24px]">
                        <div class="block pb-2 mb-2 -mx-4 border-gray-300 dark:border-gray-700 md:flex">                                            
                            <div class="w-full px-4 md:2/3">
                                <div class="flex justify-between">
                                    <div>
                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]"> checkin Date</p>                                        
                                    </div>
                                    <div>
                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">{{booking.checkin_date}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>  
                        <div class="block pb-2 mb-2 -mx-4 border-gray-300 dark:border-gray-700 md:flex">                                            
                            <div class="w-full px-4 md:2/3">
                                <div class="flex justify-between">
                                    <div>
                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]"> checkout Date</p>                                        
                                    </div>
                                    <div>
                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">{{booking.checkout_date}}</p>
                                    </div>
                                </div>
                            </div>
                        </div> 
                        <div class="block pb-2 mb-2 -mx-4 border-gray-300 dark:border-gray-700 md:flex">                                            
                            <div class="w-full px-4 md:2/3">
                                <div class="flex justify-between">
                                    <div>
                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]"> Total Days</p>                                        
                                    </div>
                                    <div>
                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">{{booking.total_days}} days</p>
                                    </div>
                                </div>
                            </div>
                        </div> 
                        <div class="block pb-2 mb-2 -mx-4 border-gray-300 dark:border-gray-700 md:flex">                                            
                            <div class="w-full px-4 md:2/3">
                                <div class="flex justify-between">
                                    <div>
                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]"> Adults</p>                                        
                                    </div>
                                    <div>
                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">{{booking.num_adults}} </p>
                                    </div>
                                </div>
                            </div>
                        </div> 
                        <div class="block pb-2 mb-2 -mx-4 border-gray-300 dark:border-gray-700 md:flex">                                            
                            <div class="w-full px-4 md:1/3">
                                <div class="flex justify-between">
                                    <div>
                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">Children</p>                                        
                                    </div>
                                    <div>
                                        <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">{{booking.num_children}}</p>
                                    </div>
                                </div>
                            </div>
                        </div> 
                        
                        <div class="block pb-2 mb-2 -mx-4 border-gray-300 dark:border-gray-700 md:flex">                                            
                            <div class="w-full px-4 md:1/3">
                                <div class="flex justify-between">
                                    <form method="post" class="flex flex-col md:flex-row items-center">
                                        {% csrf_token %}
                                        <!-- Coupon Code Input -->
                                        <div class="mb-4 md:mr-4">
                                            <label for="coupon" class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">Coupon Code:</label>
                                            <input type="text" id="coupon" name="code" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your coupon code">
                                        </div>
                                    
                                        <!-- Apply Button -->
                                        <div class="text-center md:ml-4">
                                            <button class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring focus:ring-blue-500 focus:border-blue-500">
                                                Apply
                                            </button>
                                        </div>
                                    </form>                                    
                                    
                                </div>
                            </div>
                        </div> 
                        <div class="block pb-2 mb-2 -mx-4 border-gray-300 dark:border-gray-700 md:flex">                                            
                            <div class="w-full px-4 md:1/3">
                                <div class="flex justify-between">
                                    
                                        <div>
                                            <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">Discount</p>                                        
                                        </div>
                                        <div>
                                            <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">Kshs. {{booking.saved}}</p>
                                        </div>
                                    
                                </div>
                            </div>
                        </div> 
                        <div class="block pb-4 mb-2 -mx-4 border-t border-gray-300 dark:border-gray-700 md:flex">                                            
                            <div class="w-full px-4 md:1/3">
                                <div class="flex justify-between">
                                    
                                        <div>
                                            <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">Total</p>                                        
                                        </div>
                                        <div>
                                            <p class="mb-[14px] text-[#333] font-medium tracking-normal leading[1]">Kshs.   {{booking.total}}</p>
                                        </div>
                                    
                                </div>
                            </div>
                        </div> 
                        <div class="block pb-6 mb-6 -mx-4  border-gray-300 dark:border-gray-700 md:flex"> 
                            <div id="paypal-button-container"></div>
                            <button class="button" id="checkout-button"><i class="fa fa-credit-card" aria-hidden="true"></i> Pay with Stripe</button>
                            
                            <!-- <button type="submit" class="duration-[0.3s] ease-in-out border-[1px] border-solid border-[#ed5b31] px-[15px] py-[5px] leading-[28px] bg-[#ed5b31] text-[#fff] relative z-[2] text-[15px] font-medium tracking-[1px] rounded-[10px] hover:bg-inherit hover:text-[#ed5b31]">Continue to checkout
                                
                            </button>                                            -->
                           
                        </div> 
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://www.paypal.com/sdk/js?client-id=test"></script>
    <script src="https://js.stripe.com/v3/" async></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js" integrity="sha512-+k1pnlgt4F1H8L7t3z95o3/KO+o78INEcXTbnoJQ/F2VqDVhWoaiVml/OEHv9HsVgxUaVW+IbiZPUJQfF/YxZw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        let booking_total = {{booking.total}};
        let booking_usd = {{total_usd}}
        let booking_id = "{{booking.booking_id}}";
        let success_id = "{{booking.success_id}}";
        console.log(success_id);
        paypal.Buttons({
            createOrder : function (data, actions) {
                return actions.order.create({
                    purchase_units:[{
                        amount:{
                            value:booking_usd,
                        }
                    }]
                })
                
            }, 

            onApprove: function(data, actions){
                return actions.order.capture().then(function(Detail){
                    if (Detail.status === "COMPLETED") {
                        //redirect to the success page 
                        window.location.href = `/success/${booking_id}/?success_id=${success_id}&payer_id=${Detail.id}&status=${Detail.status}&booking_total=${booking_total}`;
                    }
                })
            }
        }).render("#paypal-button-container")
    </script>
    <script>
        var stripe = Stripe('{{stripe_publishable_key}}');
        var checkoutButton = document.getElementById("checkout-button")
        checkoutButton.addEventListener('click',function(){
            var email = '{{booking.email}}'
            checkoutButton.innerHTML="Processing <i class='fa fa-spinner fa-spin'></i>"
            fetch('/api/create_checkout_session/{{booking.booking_id}}/',{
                method:"POST",
                body: JSON.stringify(
                    {email:email}
                )
            }).then(function(response){
                console.log(response);
                return response.json;

            })
        })
    </script>
</section>



<!-- Tap to top -->
<a href="#" class="back-to-top hidden fixed right-[15px] bottom-[15px] z-10 hover:text-[#fff] cursor-pointer w-[38px] h-[38px] rounded-[20px] bg-[#ed5b31] text-[#fff] text-center text-[22px] leading-relaxed result-placeholder">
    <i class="ri-arrow-up-double-line text-[20px]"></i>
</a>


{% endblock body %}